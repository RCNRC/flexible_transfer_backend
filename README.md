# Flexible Transfer Backend  

## 1. Описание и цель проекта  
Бэкенд-сервис для P2P платформы обмена валют между пользователями из разных стран. Основные цели:  
- Обеспечение кросс-валютных операций по принципу peer-to-peer  
- Автоматический подбор совпадающих ордеров с минимальной комиссией (0.5-1%)  
- Интеграция с внешними API для получения актуальных курсов валют  
- Механизм резервирования средств и подтверждения транзакций  
- Двухэтапная верификация пользователей (KYC)  

## 2. Архитектура системы  

### Основные компоненты  
```
├── delivery/      # HTTP обработчики и роутинг  
├── usecase/       # Бизнес-логика операций  
├── repository/    # Работа с БД и внешними сервисами  
├── domain/        # Ядро системы (сущности, валидация)  
└── config/        # Конфигурация приложения  
```

### Принцип работы
1. Пользователь создает заявку на обвалюту через API
2. Система проверяет минимальный лимит и доступность валюты
3. Ищет совпадения среди активных ордеров
4. Резервирует средства на счетах участников
5. Выполняет обмен при подтверждении сделки
6. Обновляет статусы ордеров и балансы пользователей

## 3. Требования
- Go 1.21+
- MySQL 8.0+
- Redis 6.2+
- Docker 20.10+

## 4. Установка и запуск

### Шаг 1: Запуск БД
```bash
docker run --name flex_db -e MYSQL_ROOT_PASSWORD=secret -p 3306:3306 -d mysql:8.0
```

### Шаг 2: Инициализация БД
```sql
mysql -h 127.0.0.1 -u root -p secret < init.sql
```

### Шаг 3: Настройка окружения  
Создайте .env файл:
```bash
DB_HOST=localhost
DB_PORT=3306
DB_USER=root
DB_PASSWORD=secret
DB_NAME=flex_exchange
```

### Шаг 4: Сборка и запуск
```bash
go mod tidy
go build -o app ./...
./app
```

## 5. Примеры API запросов

Создание ордера:
```bash
curl -X POST http://localhost:8080/orders \
-H "Content-Type: application/json" \
-d '{
  "id": "test123",
  "user_from": "user1",
  "currency_from": "USD",
  "currency_to": "EUR", 
  "amount_from": 100
}'
```

Получение списка валют:
```bash
curl http://localhost:8080/currencies
```

## 6. Мониторинг
Журналирование операций осуществляется через Zap logger:  
```logs/application.log```  
Уровни логирования:
- DEBUG: Отладка операций
- INFO: Успешные транзакции  
- ERROR: Критические ошибки